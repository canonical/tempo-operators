# Copyright 2023 Canonical Ltd.
# See LICENSE file for licensing details.

name: tempo-worker-k8s
display-name: Tempo Charmed Operator

assumes:
  - k8s-api

  # Juju 3.4+ needed for pebble log forwarding
  - juju >= 3.4.0

summary: Tempo for Kubernetes clusters.
description: |
  Grafana Tempo is an open source software project that provides a scalable long-term storage for Prometheus.
  This charm deploys and operates Tempo on Kubernetes clusters

docs: https://discourse.charmhub.io/t/tempo-worker-k8s-index/13464
source: https://github.com/canonical/tempo-worker-k8s-operator
issues: https://github.com/canonical/tempo-worker-k8s-operator/issues

requires:
  tempo-cluster:
    interface: tempo_cluster
    limit: 1

  tracing:
    interface: tracing
    limit: 1
    description: |
      Enables sending traces to the tracing backend

storage:
  data:
    type: filesystem
    description: Common storage point for all components
  recovery-data:
    type: filesystem
    description: Recovery data root for all components

# The Tempo coordinator has a hardcoded dependency on the mount location,
# and it relies on this path to generate the configuration.
# Any changes to this path may affect the coordinator's functionality.

containers:
  tempo:
    resource: tempo-image
    mounts:
      - storage: data
        location: /data
      - storage: recovery-data
        location: /recovery-data

resources:
  tempo-image:
    type: oci-image
    description: OCI image for Grafana Tempo
    upstream-source: docker.io/ubuntu/tempo:2-22.04
